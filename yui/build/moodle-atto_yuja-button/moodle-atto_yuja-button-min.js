YUI.add("moodle-atto_yuja-button",function(t,e){/**
 * YuJa Plugin for Moodle Atto button implementation
 * @package    atto_yuja
 * @subpackage yuja
 * @copyright  2016 YuJa
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */ function n(t,e){var n,i,a,o,A,d,s,r=r||jQuery,l="toastMessageContainer",c="yujaToastMessageStyles",p="yuja-toast-message",h=p;function u(t){return"#"+(t||"")}function $(t){return 1===r(u(t)).length}function g(t){return function(){1===t.length&&t.css({display:"none"})}}!function t(){if(!$(l)){var e=r("<div>").attr("id",l);r(document.body).append(e)}}(),function t(){if(!$(c)){var e=[];e.push("#toastMessageContainer{\n    position: absolute;\n    left: 0;\n    right: 0;\n    margin: 0 auto;\n    z-index: 9999;\n    width: 420px;\n    top: 50px;\n}\n"),e.push('.yuja-toast-message {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAARkSURBVEiJhZZNbFRVFMd/577XDwTiQg3YvuEjRYMLo6nsWAmRGJB2Os82CExbMVExUVGhdWEMLEzAamtiNLoQ6BRYNDMtI9YFiZJA3GHEGKMxpLbMTGvCwg+0rZ1597h4b0o/pniSSW7u+d///5zzv7lvhDtEarBunTqmWWAXwgYUDwAhjzImyhdF12YPxCdyy3FIpc3+Qa9eHN4GngOcOxUBWJBMYJyuZ1vGxv5XYCAdi6voALAKmAUdRsx5KQXf6UyQB5Bax8M4jdYQF9U4UA3cEmR/0s99vqzAQNp7VYVewAikDaZ7n39j9E7lnx6ONThWexRaAKtwqMPPf7hEIKo8A6iqdHU8netd0t2Q1w2QTORPLM71p70jIhwPSaWl3IkAnMnUexb5KRyLHG73c+8vJa9/RFWuAYjoo8lE4fvFmFTG6wJOALeqXNn8THNuwgBYkWPAKoF0JfIwzGvllSqHKiHa/fy7wHlgdbGoRwEkNVi3DseMAoGDeajSzAcy6+9Xgl8BN9oqCc7GpD8+uQQ76G1Shx8Bx6Ab3OieO6Dpff6N0VODG9Y6bmm36G1/lNLjIDVAJtrylVLvQMa7NIcRNCi5F5JtY9dTmVgWtNWKaXYFdgKImiyA6wbHVenQBXWFWhbbB2AwPsgehT1zEAXXDfqBThHNqtKK6k4X2BQe0qsAgXLSQCtwF/APyjkERfTnzsTENwCpofrXUdms4XXeG2GnAuVkOEB7FceA0GCAtQBV9t9JgE4/d1msPAn8DazE4Iz+kD/Ynij0zZmZKPQlE/kXBS2WyY3Vpk4/dxmghmIh6qreLDYJINmau4JoMzCFcqDh4djHS8wc8j4BOQhMKfrU/tbCV+Xc7OzdJhKwBpgAmHar6+YTtCcKXxurTSFOX+gfqr+nnDt3oe5e4HkAY7Wpwy9cmn+2WDtVF1k34QKjwIPGmseAX+YD1ejvocE6tqJU+GNgKHYYwJ3O9ZUcbxxYH2IWhsFsiZajRpQRAGuILwaqmh3hSq7NON5FVe1R1Z4Zx7uIci1MmSeWCAjNYecyYoquzQKBqMZPD8caFiCF8uFmYBvwW/TbhhCOT9kx/8jZtPeAhvgSgWbNgfhETuEUUO1Y7SkDU6k1K4Gtc1LCFcFpFJxGhCvcfii3RlhUkQB6gCpBPutoyxdCtwOOArcUWvrT3hEAVlVtAWrCWUnf9M0125P++GTSH5+cvrlmOyrla1sTYRnIeN2E4/kTzDGY/1xnYk2KDkeVvOnM1H5qV8z0InzZnsgPLZ4zQGrIS6DsrA2q35gxswcR3glJtSnpF0YWCAD0Z7yXBT4IfWKYgK5kW/56JfL5My+JvidIE2AReaU9kfuonF/yyUyl63Yj5iywGiiCnBfRbMnab1faYh5gxnVjgtOIEo8MrUL5S0T3litfVgDg5ODa+1zjvoXwEref6OXCAmcFp7vS811RoBxnMvWeFdMsVnepsBGivy2QB0YVGSHQbEdbvrAcx3+/BcsBIawLQwAAAABJRU5ErkJggg==") !important;\n    background-repeat: no-repeat;\n    background-position: 15px center;\n    background-color: white;\n    padding: 15px;\n    -moz-border-radius: 3px 3px 3px 3px;\n    -webkit-border-radius: 3px 3px 3px 3px;\n    border-radius: 3px 3px 3px 3px;\n    -moz-box-shadow: 0 0 12px #999999;\n    -webkit-box-shadow: 0 0 12px #999999;\n    box-shadow: 0 0 12px #999999;\n    opacity: 0.95;\n    -ms-filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=80);\n    filter: alpha(opacity=80);\n    position: relative;\n    cursor: pointer;\n}'),e.push(".message-container {\n    padding-left: 25px;\n}"),e.push(".message-content {\n    padding-left: 15px;\n}"),e.push(".header {\n    font-weight: bold;\n    font-size: 15px;\n    color: #A2AD1C;\n}\n"),e.push('.left-side-border{\n    content: url("data:image/png;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAAAAD/4QMxaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzEzOCA3OS4xNTk4MjQsIDIwMTYvMDkvMTQtMDE6MDk6MDEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjU1MTM3NzE3QkE4MzExRTc5RDFBQ0QzQTA5NDIwQkI2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjU1MTM3NzE4QkE4MzExRTc5RDFBQ0QzQTA5NDIwQkI2Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTUxMzc3MTVCQTgzMTFFNzlEMUFDRDNBMDk0MjBCQjYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NTUxMzc3MTZCQTgzMTFFNzlEMUFDRDNBMDk0MjBCQjYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAAbGhopHSlBJiZBQi8vL0JHPz4+P0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHAR0pKTQmND8oKD9HPzU/R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0f/wAARCABKAAUDASIAAhEBAxEB/8QAZwABAAMBAAAAAAAAAAAAAAAAAAMEBQIBAQEBAQAAAAAAAAAAAAAAAAQCAwUQAQACAQUBAAAAAAAAAAAAAAABYRORoQISUhQRAAECBQUBAAAAAAAAAAAAAAABEyFhAhJS8JGh4SIU/9oADAMBAAIRAxEAPwDUGbk4+o1gR8qZcdhXqsdbGZ0kXfl50F3Dm0ma+KaEmSByHq5GsSlnrcUM1CmxNqEHao3HIZAn1M//2Q==");\n    width: 5px;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    left: 0;}\n'),e.push(".toast-lifetime-progress {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    transition: width 3s, background-color 3s;\n    height: 5px;\n    background-color: #73ff04;\n}"),e.push(".toast-lifetime-progress.start-animation {\n    background-color: #ff0005;\n    width: 100%;\n}");var n=r("<style>").attr("id",c).append(e);r(document.head).append(n)}}(),d=h+"-"+(r("."+p).length+1),s=r(u(l)),1===s.length&&(s.append(r("<div>").attr("id",d).attr("class",p).on("click",function(t){g(r(u(d)))}).append((n=r("<div>").attr("class","left-side-border"),i=r("<div>").attr("class","toast-lifetime-progress"),a=r("<div>").attr("class","message-content header").append(t),o=r("<div>").attr("class","message-content body").append(e),r("<div>").attr("class","message-container").append(i).append(n).append(a).append(o)))),setTimeout(function(){1===s.length&&s.find(u(d)).find(".toast-lifetime-progress").addClass("start-animation")},25),setTimeout((A=d,function(){var t=r(u(A));1===t.length&&(t.css({transition:"opacity 1000ms",opacity:"0"}),setTimeout(g(t),1e3))}),3e3))}t.namespace("M.atto_yuja").Button=t.Base.create("button",t.M.editor_atto.EditorPlugin,[],{_mediaSelector:null,_params:{},_handlerLoaded:!1,initializer:function(){var t=this._params;t.videosUrl=this.get("yujaVideosUrl"),t.jsUrl=this.get("yujaJsUrl"),t.error=this.get("yujaError"),t.ltiVersion=this.get("ltiVersion"),t.lti3LoginInitiationUrl=this.get("lti3LoginInitUrl"),window.XMLHttpRequest?t.xmlhttp=new XMLHttpRequest:t.xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),t.isYujaConnected=!1,t.yujaConnectedCallback=null,t.xmlhttp.onreadystatechange=function(){if(t.xmlhttp.readyState==XMLHttpRequest.DONE){if(200==t.xmlhttp.status)try{t.videos=JSON.parse(t.xmlhttp.responseText)}catch(e){t.videos={success:!1}}else t.videos={success:!1};"function"==typeof t.yujaConnectedCallback&&(t.yujaConnectedCallback(),t.yujaConnectedCallback=null)}},this.addButton({icon:"icon",iconComponent:"atto_yuja",callback:this._openMediaSelector})},_openMediaSelector:function(){var e=this._params;if("1.3"==e.ltiVersion){this._loadIframe(e.lti3LoginInitiationUrl);return}var i=!1;e.isYujaConnected?void 0!==e.error?(n("Error",M.util.get_string("phperror","atto_yuja")),i=!0):void 0!==e.videos&&!1===e.videos.success?(n("Loading...",M.util.get_string("loadingerror","atto_yuja")),i=!0):(void 0===e.videos||"undefined"==typeof yuja||void 0===yuja)&&(n("Loading...",M.util.get_string("notready","atto_yuja")),i=!0):(e.isYujaConnected=!0,this._loadScript(e.jsUrl),e.xmlhttp.open("GET",e.videosUrl,!0),e.xmlhttp.send(),i=!0,e.yujaConnectedCallback=this._openMediaSelector.bind(this)),!i&&(null===this._mediaSelector&&(this._mediaSelector=yuja.createMediaSelector(e.videos.data)),this._mediaSelector.onSelect(t.bind(this._insertContent,this)),this._mediaSelector.open())},_insertContent:function(t){this.editor.focus(),this.get("host").insertContentAtFocusPoint(t),this.markUpdated()},_loadScript:function(t){var e=document.createElement("script");e.src=t,(document.body||document.head||document.documentElement).appendChild(e)},_loadIframe:function(t){var e=document.createElement("script");e.onload=(function(){require(["jquery"],(function(e){if(e("#yujaVideoChooserIFrame").attr("src",t),!this._handlerLoaded){function n(t){if("getVideo"==t.data.type){var e=t.data.embed;this._insertContent(e),require(["jquery"],function(t){t(".yuja-overlay").removeClass("yuja-overlay-visible"),t("#yujaVideoChooserIFrame").attr("src","")})}}window.addEventListener?window.addEventListener("message",n.bind(this),!1):window.attachEvent&&window.attachEvent("onmessage",n.bind(this)),this._handlerLoaded=!0}}).bind(this))}).bind(this),e.src=location.origin+"/local/yuja/media_selection.js",(document.body||document.head||document.documentElement).appendChild(e)}},{ATTRS:{yujaVideosUrl:{value:void 0},yujaJsUrl:{value:void 0},yujaError:{value:void 0},ltiVersion:{value:void 0},lti3LoginInitUrl:{value:void 0}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});